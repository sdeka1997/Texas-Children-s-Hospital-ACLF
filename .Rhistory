fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=50, "above50", "below50"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$pretrans_death)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=332, "above332", "below332"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$pretrans_death)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=332, "above332", "below332"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$status.x)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=332, "above332", "below332"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$pretrans_death)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=332, "above332", "below332"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$status.x)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=332, "above332", "below332"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$pretrans_death)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(life = ifelse(status.x =='living', 0, 1))
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=332, "above332", "below332"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$pretrans_death)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(life = ifelse(status.x =='living', 0, 1))
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=332, "above332", "below332"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$life)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(life = ifelse(status.x =='living', 0, 1))
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=298, "above298", "below298"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$life)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(life = ifelse(aclf_status.x =='ACLF', 0, 1))
merged <- merged %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
merged$bili_group <- factor(merged$bili_group)
merged <- merged %>% mutate(inr_group = ifelse(inr >=1.3, "above1.3", "below1.3"))
merged$inr_group <- factor(merged$inr_group)
merged <- merged %>% mutate(plat_group = ifelse(platelets >=142, "above142", "below142"))
merged$plat_group <- factor(merged$plat_group)
merged <- merged %>% mutate(ggt_group = ifelse(ggt >=298, "above298", "below298"))
merged$ggt_group <- factor(merged$ggt_group)
merged <- merged %>% mutate(PELD_group = ifelse(PELD >=9, "above9", "below9"))
merged$PELD_group <- factor(merged$PELD_group)
surv_object <- Surv(time = merged$wait, event = merged$life)
#fit1 <- survfit(surv_object ~ aclf_status.x, data = merged)
fit2 <- survfit(surv_object ~ bili_group, data = merged)
fit3 <- survfit(surv_object ~ inr_group, data = merged)
fit4 <- survfit(surv_object ~ plat_group, data = merged)
fit5 <- survfit(surv_object ~ ggt_group, data = merged)
fit6 <- survfit(surv_object ~ PELD_group, data = merged)
#ggsurvplot(fit1, data = merged, pval = TRUE)
ggsurvplot(fit2, data = merged, pval = TRUE)
ggsurvplot(fit3, data = merged, pval = TRUE)
ggsurvplot(fit4, data = merged, pval = TRUE)
ggsurvplot(fit5, data = merged, pval = TRUE)
ggsurvplot(fit6, data = merged, pval = TRUE)
#bili <- subset(merged, bili_group=='above20')
median(merged$total_bili)
median(merged$inr)
median(merged_plat$platelets)
quantile(merged_ggt$ggt)
median(merged$PELD)
write.csv(merged, file = "merged.csv")
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
BA_in_ACLF_Simplified_Deidentified <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
setwd("~/Desktop/_Summer18")
library(readxl)
BA_in_ACLF_Simplified_Deidentified <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
library(readxl)
BA_in_ACLF_Simplified_Deidentified <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
View(BA_in_ACLF_Simplified_Deidentified)
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
merged <- merged %>% mutate(life = ifelse(aclf_status.x =='ACLF', 0, 1))
survivaldata <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
View(survivaldata)
library(readxl)
survivaldata <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
for (row in 1:nrow(survivaldata)){
survivaldata$GF.factor[row] <- GF_calc(survivaldata$listing_age[row], survivaldata$height[row], survivaldata$weight[row], survivaldata$sex[row])
}
#ACLF <- subset(merged, aclf_status.x=='ACLF')
#kasai_ACLF <- subset(ACLF, kasai_status == 1)
#median(ACLF$listing_age)
#non_ACLF <- subset(merged, aclf_status.x=='non-ACLF')
#median(non_ACLF$listing_age)
#sum(with(merged, aclf_status.x=='non-ACLF' & pretrans_death==1))
#data <- read.csv("ba_data_2015_v4.csv")
#data$listing_peld <- 10*(0.480*log(data$total_bili)+1.857*log(data$inr)
#                         -0.687*log(data$albumin)+0.463*data$age.factor)
#data[data$listing_peld <0,]$listing_peld <- 0
#data <- subset(data, listing_age < 1856)
library(readxl)
Male_UNOS_GF <- read_excel("Male UNOS GF.xlsx",
col_types = c("numeric", "numeric", "numeric",
"numeric"))
library(readxl)
Female_UNOS_GF <- read_excel("Female UNOS GF.xlsx",
col_types = c("numeric", "numeric", "numeric",
"numeric"))
GF_calc <- function(age, height, weight, sex){
age = age/365.25*12
mround <- function(x,base){
base*floor(x/base)
}
if (sex == 'M'){
age_lower <- Male_UNOS_GF$`Age Lower`
height_list <- Male_UNOS_GF$`Height Cut-off`
weight_list <- Male_UNOS_GF$`Weight cut-off`
}
if (sex == 'F'){
age_lower <- Female_UNOS_GF$`Age Lower`
height_list <- Female_UNOS_GF$`Height Cut-off`
weight_list <- Female_UNOS_GF$`Weight cut-off`
}
count = 1
for (num in age_lower){
if (num == mround(age,3)){
break
}
else count = count + 1
}
if (height < height_list[count]){
return(1)
}
if (weight < weight_list[count]){
return(1)
}
return(0)
}
for (row in 1:nrow(survivaldata)){
survivaldata$GF.factor[row] <- GF_calc(survivaldata$listing_age[row], survivaldata$height[row], survivaldata$weight[row], survivaldata$sex[row])
}
survivaldata$age.factor <- ifelse(age.factor$listing_age < 365, 1, 0)
survivaldata$age.factor <- ifelse(survivaldata$listing_age < 365, 1, 0)
survivaldata$PELD <- round(10*(0.480*log(survivaldata$total_bili) + 1.857*log(survivaldata$inr) - 0.687*log(survivaldata$albumin) + 0.436*(survivaldata$age.factor) + 0.667*(survivaldata$GF.factor)))
library(readxl)
survivaldata <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
for (row in 1:nrow(survivaldata)){
survivaldata$GF.factor[row] <- GF_calc(survivaldata$listing_age[row], survivaldata$height[row], survivaldata$weight[row], survivaldata$sex[row])
}
survivaldata$age.factor <- ifelse(survivaldata$listing_age < 365, 1, 0)
survivaldata$PELD <- round(10*(0.480*log(survivaldata$total_bili) + 1.857*log(survivaldata$inr) - 0.687*log(survivaldata$albumin) + 0.436*(survivaldata$age.factor) + 0.667*(survivaldata$GF.factor)))
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
survivaldata <- survivaldata %>% mutate(life = ifelse(aclf_status =='ACLF', 0, 1))
survivaldata <- survivaldata %>% mutate(bili_group = ifelse(total_bili >=median(survivaldata$total_bili), "above7.7", "below7.7"))
survivaldata$bili_group <- factor(survivaldata$bili_group)
survivaldata <- survivaldata %>% mutate(inr_group = ifelse(inr >=median(survivaldata$inr), "above1.3", "below1.3"))
survivaldata$inr_group <- factor(survivaldata$inr_group)
survivaldata <- survivaldata %>% mutate(plat_group = ifelse(platelets >=median(survivaldata$platelets), "above142", "below142"))
survivaldata$plat_group <- factor(survivaldata$plat_group)
survivaldata <- survivaldata %>% mutate(ggt_group = ifelse(ggt >=median(survivaldata$ggt), "above298", "below298"))
survivaldata$ggt_group <- factor(survivaldata$ggt_group)
survivaldata <- survivaldata %>% mutate(PELD_group = ifelse(PELD >=median(survivaldata$PELD), "above9", "below9"))
survivaldata$PELD_group <- factor(survivaldata$PELD_group)
surv_object <- Surv(time = survivaldata$wait, event = survivaldata$life)
library(readxl)
survivaldata <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
for (row in 1:nrow(survivaldata)){
survivaldata$GF.factor[row] <- GF_calc(survivaldata$listing_age[row], survivaldata$height[row], survivaldata$weight[row], survivaldata$sex[row])
}
survivaldata$age.factor <- ifelse(survivaldata$listing_age < 365, 1, 0)
survivaldata$PELD <- round(10*(0.480*log(survivaldata$total_bili) + 1.857*log(survivaldata$inr) - 0.687*log(survivaldata$albumin) + 0.436*(survivaldata$age.factor) + 0.667*(survivaldata$GF.factor)))
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
survivaldata <- survivaldata %>% mutate(life = ifelse(aclf_status =='ACLF', 0, 1))
survivaldata <- survivaldata %>% mutate(bili_group = ifelse(total_bili >=7.7, "above7.7", "below7.7"))
survivaldata$bili_group <- factor(survivaldata$bili_group)
survivaldata <- survivaldata %>% mutate(inr_group = ifelse(inr >=median(survivaldata$inr), "above1.3", "below1.3"))
survivaldata$inr_group <- factor(survivaldata$inr_group)
survivaldata <- survivaldata %>% mutate(plat_group = ifelse(platelets >=median(survivaldata$platelets), "above142", "below142"))
survivaldata$plat_group <- factor(survivaldata$plat_group)
survivaldata <- survivaldata %>% mutate(ggt_group = ifelse(ggt >=median(survivaldata$ggt), "above298", "below298"))
survivaldata$ggt_group <- factor(survivaldata$ggt_group)
survivaldata <- survivaldata %>% mutate(PELD_group = ifelse(PELD >=median(survivaldata$PELD), "above9", "below9"))
survivaldata$PELD_group <- factor(survivaldata$PELD_group)
surv_object <- Surv(time = survivaldata$wait, event = survivaldata$life)
library(readxl)
survivaldata <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
for (row in 1:nrow(survivaldata)){
survivaldata$GF.factor[row] <- GF_calc(survivaldata$listing_age[row], survivaldata$height[row], survivaldata$weight[row], survivaldata$sex[row])
}
survivaldata$age.factor <- ifelse(survivaldata$listing_age < 365, 1, 0)
survivaldata$PELD <- round(10*(0.480*log(survivaldata$total_bili) + 1.857*log(survivaldata$inr) - 0.687*log(survivaldata$albumin) + 0.436*(survivaldata$age.factor) + 0.667*(survivaldata$GF.factor)))
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
survivaldata <- survivaldata %>% mutate(life = ifelse(aclf_status =='ACLF', 0, 1))
survivaldata <- survivaldata %>% mutate(bili_group = ifelse(total_bili >=median(survivaldata$total_bili), "above7.7", "below7.7"))
survivaldata$bili_group <- factor(survivaldata$bili_group)
survivaldata <- survivaldata %>% mutate(inr_group = ifelse(inr >=median(survivaldata$inr), "above1.3", "below1.3"))
survivaldata$inr_group <- factor(survivaldata$inr_group)
survivaldata$platelets <- as.numeric(survivaldata$platelets)
survivaldata <- survivaldata %>% mutate(plat_group = ifelse(platelets >=median(survivaldata$platelets), "above142", "below142"))
survivaldata$plat_group <- factor(survivaldata$plat_group)
survivaldata$ggt <- as.numeric(survivaldata)
library(readxl)
survivaldata <- read_excel("BA in ACLF Simplified  - Deidentified.xlsx")
for (row in 1:nrow(survivaldata)){
survivaldata$GF.factor[row] <- GF_calc(survivaldata$listing_age[row], survivaldata$height[row], survivaldata$weight[row], survivaldata$sex[row])
}
survivaldata$age.factor <- ifelse(survivaldata$listing_age < 365, 1, 0)
survivaldata$PELD <- round(10*(0.480*log(survivaldata$total_bili) + 1.857*log(survivaldata$inr) - 0.687*log(survivaldata$albumin) + 0.436*(survivaldata$age.factor) + 0.667*(survivaldata$GF.factor)))
library(survival)
library(survminer)
library(dplyr)
#merged <- merged[complete.cases(merged$death_date.x), ]
#merged <- merged[complete.cases(merged$dob.x), ]
survivaldata <- survivaldata %>% mutate(life = ifelse(aclf_status =='ACLF', 0, 1))
survivaldata <- survivaldata %>% mutate(bili_group = ifelse(total_bili >=median(survivaldata$total_bili), "above7.7", "below7.7"))
survivaldata$bili_group <- factor(survivaldata$bili_group)
survivaldata <- survivaldata %>% mutate(inr_group = ifelse(inr >=median(survivaldata$inr), "above1.3", "below1.3"))
survivaldata$inr_group <- factor(survivaldata$inr_group)
survivaldata$platelets <- as.numeric(survivaldata$platelets)
survivaldata <- survivaldata %>% mutate(plat_group = ifelse(platelets >=median(survivaldata$platelets), "above142", "below142"))
survivaldata$plat_group <- factor(survivaldata$plat_group)
survivaldata$ggt <- as.numeric(survivaldata$ggt)
survivaldata <- survivaldata %>% mutate(ggt_group = ifelse(ggt >=median(survivaldata$ggt), "above298", "below298"))
survivaldata$ggt_group <- factor(survivaldata$ggt_group)
survivaldata <- survivaldata %>% mutate(PELD_group = ifelse(PELD >=median(survivaldata$PELD), "above9", "below9"))
survivaldata$PELD_group <- factor(survivaldata$PELD_group)
surv_object <- Surv(time = survivaldata$wait, event = survivaldata$life)
